<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Detalles de producto - Auto Partes El Sapo">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <title>Detalles del Producto - Auto Partes El Sapo</title>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo-section">
        <img src="logo.png" alt="Logo Auto Partes El Sapo" class="logo-img">
        <h1 class="logo">Auto Partes El Sapo</h1>
      </div>
      <div class="user-section">
        <div class="social-links">
          <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
          <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
        </div>
        <div class="profile">
          <i class="fas fa-user-circle"></i>
        </div>
      </div>
    </div>
    <nav class="navbar">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="informacion.html">Información</a></li>
        <li><a href="cotizaciones.html">Cotizaciones</a></li>
      </ul>
    </nav>
  </header>
  
  <main class="main container">
    <div id="producto-detalle" class="product-details-container">
      <!-- El contenido se cargará dinámicamente con JavaScript -->
    </div>
  </main>
  <footer class="footer">
    <div class="container">
      <div class="whatsapp-contact">
        <p>Contactar por WhatsApp: <a href="https://wa.me/502xxxxxxxx" target="_blank">+502 xxxxxxxx</a></p>
      </div>
      <p class="copyright">&copy; 2025 Auto Partes El Sapo. Todos los derechos reservados.</p>
    </div>
  </footer>
  
  <script>
    // URL base de la API
    const API_URL = "http://localhost:5171/api";
    
    document.addEventListener('DOMContentLoaded', async () => {
      // Obtener el ID del producto de la URL
      const urlParams = new URLSearchParams(window.location.search);
      const productoId = urlParams.get('id');
      
      if (!productoId) {
        window.location.href = 'index.html';
        return;
      }
      
      await cargarDetalleProducto(productoId);
    });
    
    async function cargarDetalleProducto(id) {
      try {
        mostrarCargando(true);
        
        const respuesta = await fetch(`${API_URL}/Productos/${id}`);
        
        if (!respuesta.ok) {
          if (respuesta.status === 404) {
            mostrarError("Producto no encontrado");
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 3000);
            return;
          }
          throw new Error(`Error HTTP: ${respuesta.status}`);
        }
        
        const producto = await respuesta.json();
        renderizarDetalleProducto(producto);
      } catch (error) {
        console.error("Error al cargar detalle del producto:", error);
        mostrarError("No se pudo cargar el detalle del producto");
      } finally {
        mostrarCargando(false);
      }
    }
    
    function renderizarDetalleProducto(producto) {
      const detalleContainer = document.getElementById('producto-detalle');
      
      // Determinar clase de stock
      let stockClass = 'in-stock';
      let stockText = 'En stock';
      
      if (producto.stock <= 0) {
        stockClass = 'out-of-stock';
        stockText = 'Agotado';
      } else if (producto.stock < 5) {
        stockClass = 'low-stock';
        stockText = 'Pocas unidades';
      }
      
      detalleContainer.innerHTML = `
        <div class="product-image-container">
          <img src="${producto.imagen || 'placeholder.jpg'}" alt="${producto.nombre}" class="product-image" onerror="this.src='placeholder.jpg'">
        </div>
        <div class="product-info-detail">
          <h2>${producto.nombre}</h2>
          
          <div class="product-meta">
            <div class="meta-item">
              <span class="meta-label">Marca:</span>
              <span class="meta-value">${producto.marca || 'N/A'}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Modelo:</span>
              <span class="meta-value">${producto.modelo || 'N/A'}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Año:</span>
              <span class="meta-value">${producto.año || 'N/A'}</span>
            </div>
          </div>
          
          <p class="price-detail">Q${producto.precio.toFixed(2)}</p>
          <div class="stock-info ${stockClass}">${stockText}</div>
          
          <a href="index.html" class="back-button">Volver al catálogo</a>
          
          ${producto.stock > 0 ? `
            <div class="cotizacion-form">
              <h3>Solicitar cotización</h3>
              <form id="cotizacion-form" onsubmit="enviarCotizacion(event, ${producto.id})">
                <div class="form-group">
                  <label for="nombre">Nombre completo:</label>
                  <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                  <label for="email">Correo electrónico:</label>
                  <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                  <label for="telefono">Teléfono:</label>
                  <input type="tel" id="telefono" name="telefono" required>
                </div>
                <div class="form-group">
                  <label for="cantidad">Cantidad:</label>
                  <input type="number" id="cantidad" name="cantidad" min="1" max="${producto.stock}" value="1" required>
                </div>
                <div class="form-group">
                  <label for="mensaje">Mensaje adicional (opcional):</label>
                  <textarea id="mensaje" name="mensaje" rows="3"></textarea>
                </div>
                <button type="submit" class="cotizar-button">Solicitar cotización</button>
              </form>
            </div>
          ` : ''}
        </div>
      `;
    }
    
    function enviarCotizacion(event, productoId) {
      event.preventDefault();
      
      const formData = {
        productoId: productoId,
        nombre: document.getElementById('nombre').value,
        email: document.getElementById('email').value,
        telefono: document.getElementById('telefono').value,
        cantidad: document.getElementById('cantidad').value,
        mensaje: document.getElementById('mensaje').value
      };
      
      // Aquí puedes implementar la lógica para enviar la cotización a través de la API
      // Por ahora, simplemente mostramos un mensaje de éxito
      alert('Cotización enviada con éxito. Nos pondremos en contacto contigo pronto.');
      document.getElementById('cotizacion-form').reset();
    }
    
    // Función para mostrar indicador de carga
    function mostrarCargando(mostrar) {
      let loadingElement = document.querySelector('.loading-indicator');
      
      if (mostrar) {
        if (!loadingElement) {
          loadingElement = document.createElement('div');
          loadingElement.className = 'loading-indicator';
          loadingElement.innerHTML = '<div class="spinner"></div><p>Cargando...</p>';
          document.body.appendChild(loadingElement);
        }
        loadingElement.style.display = 'flex';
      } else if (loadingElement) {
        loadingElement.style.display = 'none';
      }
    }
    
    // Función para mostrar mensajes de error
    function mostrarError(mensaje) {
      const errorElement = document.createElement('div');
      errorElement.className = 'error-message';
      errorElement.textContent = mensaje;
      
      document.body.appendChild(errorElement);
      
      // Eliminar después de 5 segundos
      setTimeout(() => {
        errorElement.remove();
      }, 5000);
    }
  </script>
</body>
</html>